<!-- ---------------------------------------------------------------------------------------- -->

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Professor Portal - Prompt Evaluation</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      margin: 0;
      background: linear-gradient(135deg, #e6ffe6, #c8f0c8);
      color: #333;
    }

    header {
      background-color: #2c3e50;
      color: #ffffff;
      padding: 20px 30px;
      text-align: center;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      font-size: 1.8em;
      font-weight: bold;
    }

    header button {
      float: right;
      font-size: 0.6em;
      padding: 8px 14px;
      border: none;
      background-color: #e74c3c;
      color: white;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }

    .main-content {
      display: flex;
      flex-grow: 1;
      padding: 20px;
      gap: 20px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .prompts-panel,
    .simulation-panel {
      background-color: #ffffff;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
    }

    .prompts-panel {
      flex: 0 0 250px;
    }

    .simulation-panel {
      flex: 2;
      min-width: 500px;
      position: relative;
      min-height: 400px;
    }

    h2 {
      color: #27ae60;
      margin: 0 0 20px 0;
      font-size: 1.7em;
      border-bottom: 2px solid #e0e0e0;
      padding-bottom: 10px;
    }

    .team-button {
      display: block;
      width: 100%;
      margin: 8px 0;
      padding: 12px;
      border: none;
      background-color: #3498db;
      color: white;
      border-radius: 8px;
      font-size: 1.05em;
      cursor: pointer;
      transition: background-color 0.3s ease;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      font-weight: bold;
    }

    .team-button:hover {
      background-color: #2980b9;
    }

    .rating-button {
      margin: 5px;
      padding: 10px 15px;
      font-size: 1em;
      background-color: #f1f1f1;
      border: 1px solid #ccc;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.2s;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      font-weight: bold;
    }

    .rating-button:hover {
      background-color: #ddd;
    }

    #promptModal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: rgba(0, 0, 0, 0.6);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 999;
    }

    #promptModalContent {
      background: white;
      padding: 25px;
      border-radius: 10px;
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
    }

    #promptModalContent h3 {
      margin-top: 0;
      color: #2c3e50;
    }

    #promptText {
      white-space: pre-wrap;
      word-wrap: break-word;
      overflow-wrap: break-word;
      font-size: 1em;
      margin-bottom: 20px;
      color: #444;
    }

    #closeModalBtn {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 1.2em;
      background: none;
      border: none;
      color: #888;
      cursor: pointer;
    }

    #closeModalBtn:hover {
      color: #333;
    }

    @media (max-width: 1024px) {
      .main-content {
        flex-direction: column;
        align-items: center;
      }

      .prompts-panel,
      .simulation-panel {
        width: 95%;
      }
    }
  </style>
</head>

<body>
  <header>Professor Dashboard - NH9 Cattle Problem

    <button onclick="refreshPrompts()">
      ðŸ”„ Refresh
    </button>

  </header>

  <div class="main-content">
    <div class="prompts-panel">
      <h2>Team Prompts</h2>
      <div id="promptsList">
        <p>Loading prompts...</p>
      </div>
    </div>

    <div class="simulation-panel">
      <h2>NH9 Cattle Simulation</h2>
      <iframe id="simulationIframe" src="simulation.html"
        style="width: 100%; height: 100%; border: none; border-radius: 8px;"></iframe>
    </div>
  </div>

  <div id="promptModal">
    <div id="promptModalContent">
      <button id="closeModalBtn" onclick="closeModal()">âœ–</button>
      <h3 id="modalTitle">Team Prompt</h3>
      <div id="promptText"></div>
      <div>
        <label><strong>Rate this Prompt (out of 10):</strong></label>
        <div id="ratingScale">
        </div>
      </div>
    </div>
  </div>

  <script>

    // Function to refresh and remove all prompts
    function refreshPrompts() {
      if (confirm("Are you sure you want to refresh all prompts and ratings?")) {
        for (let i = 1; i <= 6; i++) {
          const teamId = `team${i}`;
          localStorage.removeItem(`team_${teamId}_prompt`);
          localStorage.removeItem(`team_${teamId}_rating`);
        }
        loadPrompts(); // Refresh the list
        alert("All team prompts and ratings have been cleared!");
      }
    }

    function loadPrompts() {
      const promptsList = document.getElementById("promptsList");
      promptsList.innerHTML = "";
      let found = false;

      for (let i = 1; i <= 6; i++) {
        const teamId = `team${i}`;
        const key = `team_${teamId}_prompt`;
        const prompt = localStorage.getItem(key);
        if (prompt) {
          found = true;
          const btn = document.createElement("button");
          btn.textContent = `Team-${i}`;
          btn.className = "team-button";
          btn.onclick = () => showPromptModal(`Team-${i}`, prompt);
          promptsList.appendChild(btn);

          // Check if there's a rating stored for this prompt
          const ratingKey = `team_${teamId}_rating`;
          const rating = localStorage.getItem(ratingKey);
          if (rating) {
            const ratingDisplay = document.createElement("span");
            ratingDisplay.textContent = ` (${rating}/10)`;
            ratingDisplay.style.marginLeft = '10px';
            ratingDisplay.style.fontWeight = 'bold';
            btn.appendChild(ratingDisplay);
          }
        }
      }

      if (!found) {
        promptsList.innerHTML = "<p>No prompts submitted yet.</p>";
      }
    }

    function showPromptModal(team, promptText) {
      document.getElementById("modalTitle").textContent = `${team}'s Prompt`;
      document.getElementById("promptText").textContent = promptText;

      const ratingScale = document.getElementById("ratingScale");
      ratingScale.innerHTML = "";

      const teamId = team.toLowerCase().replace('-', ''); // Convert 'Team-1' to 'team1'
      const currentRatingKey = `team_${teamId}_rating`;
      const currentRating = localStorage.getItem(currentRatingKey);

      for (let i = 1; i <= 10; i++) {
        const btn = document.createElement("button");
        btn.textContent = i;
        btn.className = "rating-button";

        // Highlight the current rating if it exists
        if (currentRating && parseInt(currentRating) === i) {
          btn.style.backgroundColor = '#2ecc71'; // Green for selected rating
          btn.style.color = 'white';
        }

        btn.onclick = () => {
          localStorage.setItem(currentRatingKey, i); // Save the rating
          alert(`You rated ${team}'s prompt: ${i}/10`);
          closeModal();
          loadPrompts(); // Reload prompts to show the updated rating
        };
        ratingScale.appendChild(btn);
      }

      document.getElementById("promptModal").style.display = "flex";
    }

    function closeModal() {
      document.getElementById("promptModal").style.display = "none";
    }

    // --- NEW ADDITION FOR REAL-TIME REFRESH ---
    window.addEventListener('storage', (event) => {
      // Check if the changed key is one of our prompt keys
      if (event.key && event.key.startsWith('team_') && event.key.endsWith('_prompt')) {
        console.log(`localStorage key changed: ${event.key}. Reloading prompts.`);
        loadPrompts(); // Reload prompts when a relevant localStorage item changes
      }
      // Also reload if a rating changes, so the professor sees the update
      if (event.key && event.key.startsWith('team_') && event.key.endsWith('_rating')) {
        console.log(`localStorage rating changed: ${event.key}. Reloading prompts.`);
        loadPrompts(); // Reload prompts when a relevant localStorage item changes
      }
    });
    // --- END NEW ADDITION ---

    window.onload = loadPrompts;
  </script>
</body>

</html>